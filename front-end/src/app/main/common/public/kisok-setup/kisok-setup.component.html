<div class="loading-bar" *ngIf="viewLoading" [@fadeMotion]>
    <div class="__inner">
        <img src="assets/loading/gears_c1.svg">
        <span>Loading! Please Wait...</span>
    </div>
</div>
<div class="container p-24" fxLayout="column">

    <ng-container *ngIf="!isLoged">

        <div class="header p-8 pb-0 mb-4 text-center">
            <img src="../../../../../assets/images/logos/KMLOGO.png" alt="kinderm8_logo">
            <h1 class="branch-name" *ngIf="!hasUserData"> WELCOME TO {{branch?.name | uppercase}}</h1>

            <ng-container *ngIf="hasUserData">
                <h1> HI {{user?.getFullName() | uppercase}}</h1>
                <h5> please enter your pin number</h5>
            </ng-container>

            <ng-container *ngIf="!hasUserData">
                <h3>
                    Enter your mobile number
                </h3>
            </ng-container>

        </div>

        <div class="header p-6 text-center output-center">
            
            <div class="text-box text-truncate" *ngIf="!hasUserData">
                
                <h3 class="mobile-number" >
                    {{mobileNumber}}
                </h3>

            </div>
            <div class="text-box text-truncate" *ngIf="hasUserData && pinCodeCheck == null && phoneCheck != null">
                <h3 class="mobile-number" >
                    {{pinCode}}
                </h3>
            </div>

            <div class="text-box text-truncate" *ngIf="hasUserData && pinCodeCheck != null">
                <h3 class="mobile-number" >
                    {{getpinCode()}}
                </h3>
            </div>

            
        </div>

        <div fxLayout="column">

            <div nz-row nzJustify="center" nzAlign="top" [nzGutter]="24">

                <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="24" [nzXl]="24" [nzXXl]="24"
                    *ngIf="!hasUserData">

                    <div style="display: block;" class=" text-center key-pad-main mt-12">
                        <div nz-row nzJustify="center"  class="key-pad-row-main">
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/one.svg" alt="1"
                                (click) = "enterKey($event,'1', false)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/two.svg" alt="2"
                                (click) = "enterKey($event,'2', false)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/three.svg" alt="3"
                                (click) = "enterKey($event,'3', false)">
                            </span>
                        </div>
                        <div nz-row nzJustify="center" class="key-pad-row-main">
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/four.svg" alt="4"
                                (click) = "enterKey($event,'4', false)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/five.svg" alt="5"
                                (click) = "enterKey($event,'5', false)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/six.svg" alt="6"
                                (click) = "enterKey($event,'6', false)">
                            </span>
                        </div>
                        <div nz-row nzJustify="center" class="key-pad-row-main">
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/seven.svg" alt="7"
                                (click) = "enterKey($event,'7', false)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/eight.svg" alt="8"
                                (click) = "enterKey($event,'8', false)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/nine.svg" alt="9"
                                (click) = "enterKey($event,'9', false)">
                            </span>
                        </div>
                        <div nz-row nzJustify="center" class="key-pad-row-main">
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/cancel.svg" alt="delete"
                                (click) = "deleteKey($event, false)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/zero.svg" alt="0"
                                (click) = "enterKey($event,'0', false)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/checked.svg" alt="ok"
                                (click) = "getClientByMobile($event)">
                            </span>
                        </div>
                    </div>

                </div>

                <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="24" [nzXl]="24" [nzXXl]="24"
                    *ngIf="hasUserData && pinCodeCheck == null && phoneCheck != null">


                    <div style="display: block;" class=" text-center key-pad-main mt-12">
                        <div nz-row nzJustify="center" class="key-pad-row-main">
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/one.svg" alt="1"
                                (click) = "enterKey($event,'1', true)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/two.svg" alt="2"
                                (click) = "enterKey($event,'2', true)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/three.svg" alt="3"
                                (click) = "enterKey($event,'3', true)">
                            </span>
                        </div>
                        <div nz-row nzJustify="center" class="key-pad-row-main">
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/four.svg" alt="4"
                                (click) = "enterKey($event,'4', true)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/five.svg" alt="5"
                                (click) = "enterKey($event,'5', true)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/six.svg" alt="6"
                                (click) = "enterKey($event,'6', true)">
                            </span>
                        </div>
                        <div nz-row nzJustify="center" class="key-pad-row-main">
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/seven.svg" alt="7"
                                (click) = "enterKey($event,'7', true)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/eight.svg" alt="8"
                                (click) = "enterKey($event,'8', true)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/nine.svg" alt="9"
                                (click) = "enterKey($event,'9', true)">
                            </span>
                        </div>
                        <div nz-row nzJustify="center" class="key-pad-row-main">
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/cancel.svg" alt="delete"
                                (click) = "deleteKey($event,true)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/zero.svg" alt="0"
                                (click) = "enterKey($event,'0', true)">
                            </span>
                            <span class="key-pad-row">
                                <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/checked.svg" alt="ok"
                                (click) = "getClientByMobile($event)">
                            </span>
                        </div>
                    </div>
                    <!-- <div class="header p-12" fxLayout="row" fxLayoutAlign="space-between center">
                        <nz-input-group class="search-container" [nzSuffix]="suffixTemplate"
                            [nzPrefix]="prefixTemplate">
                            <input type="password" nz-input placeholder="Enter your new pin number"
                                [formControl]="pin_code" />
                        </nz-input-group>

                        <ng-template #prefixTemplate>
                            <i nz-icon nzType="search" class="search-icon"></i>
                        </ng-template>

                        <ng-template #suffixTemplate>
                            <i class="times circle outline icon ant-input-clear-icon" *ngIf="pin_code.value"
                                [@fadeInOnEnter] [@fadeOutOnLeave] (click)="clearPin($event)">
                            </i>
                        </ng-template>

                    </div> -->

                    <div mat-dialog-actions class="m-0 py-16 px-24 fm-border-top" fxLayout="row"
                        fxLayoutAlign="space-between center">

                        <button nzBlock nz-button nzType="danger" nzSize="large" [promiseBtn]="buttonLoader"
                            (click)="exit()" class="m-4">
                            Back
                        </button>

                        <!-- <button nzBlock nz-button nzType="primary" nzSize="large" [disabled]="!mobile.value"
                            (click)="getClientByMobile($event)" class="m-4">
                            <i nz-icon nzType="arrow-right"></i>Next
                        </button> -->

                    </div>
                </div>

                <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="24" [nzXl]="24" [nzXXl]="24"
                    *ngIf="hasUserData && pinCodeCheck != null">

                        <div style="display: block;" class=" text-center key-pad-main mt-12">
                            <div nz-row nzJustify="center" class="key-pad-row-main">
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/one.svg" alt="1"
                                    (click) = "enterKey($event,'1', true)">
                                </span>
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/two.svg" alt="2"
                                    (click) = "enterKey($event,'2', true)">
                                </span>
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/three.svg" alt="3"
                                    (click) = "enterKey($event,'3', true)">
                                </span>
                            </div>
                            <div nz-row nzJustify="center" class="key-pad-row-main">
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/four.svg" alt="4"
                                    (click) = "enterKey($event,'4', true)">
                                </span>
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/five.svg" alt="5"
                                    (click) = "enterKey($event,'5', true)">
                                </span>
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/six.svg" alt="6"
                                    (click) = "enterKey($event,'6', true)">
                                </span>
                            </div>
                            <div nz-row nzJustify="center" class="key-pad-row-main">
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/seven.svg" alt="7"
                                    (click) = "enterKey($event,'7', true)">
                                </span>
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/eight.svg" alt="8"
                                    (click) = "enterKey($event,'8', true)">
                                </span>
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/nine.svg" alt="9"
                                    (click) = "enterKey($event,'9', true)">
                                </span>
                            </div>
                            <div nz-row nzJustify="center" class="key-pad-row-main">
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/cancel.svg" alt="delete"
                                    (click) = "deleteKey($event,true)">
                                </span>
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/zero.svg" alt="0"
                                    (click) = "enterKey($event,'0', true)">
                                </span>
                                <span class="key-pad-row">
                                    <img class="img-key" src="../../../../../assets/icons/flat/ui_set/custom_icons/key-pad/checked.svg" alt="ok"
                                    (click) = "getClientByMobile($event)">
                                </span>
                            </div>
                        </div>
                        <!-- <nz-input-group class="search-container" [nzSuffix]="suffixTemplate"
                            [nzPrefix]="prefixTemplate">
                            <input type="password" nz-input placeholder="Enter your pin number"
                                [formControl]="pin_code" />
                        </nz-input-group>

                        <ng-template #prefixTemplate>
                            <i nz-icon nzType="search" class="search-icon"></i>
                        </ng-template>

                        <ng-template #suffixTemplate>
                            <i class="times circle outline icon ant-input-clear-icon" *ngIf="pin_code.value"
                                [@fadeInOnEnter] [@fadeOutOnLeave] (click)="clearPin($event)">
                            </i>
                        </ng-template> -->


                    <div mat-dialog-actions class="m-0 py-16 px-24 fm-border-top" fxLayout="row"
                        fxLayoutAlign="space-between center">

                        <button nzBlock nz-button nzType="danger" nzSize="large" [promiseBtn]="buttonLoader"
                            (click)="exit()" class="m-4">
                            Back
                        </button>

                        <!-- <button nzBlock nz-button nzType="primary" nzSize="large" [disabled]="!mobile.value"
                            (click)="getClientByMobile($event)" class="m-4">
                            <i nz-icon nzType="arrow-right"></i>Next
                        </button> -->




                    </div>

                </div>
            </div>
        </div>

    </ng-container>

    <ng-container *ngIf="isLoged">
        <di class="text-center">
           <h3 class="timer">
            {{counter | formatTime}}
           </h3> 
        </di>
        <div>

            <div style="float: left; font-size: 12px;" class="mb-8" *ngIf="missed.length > '0' && isShowMissed">
                <i class="info circle icon ml-2" style="font-size: 18px;color: #d41414eb;" (click)="openDialog()"></i>
                {{missed.length}} Missed <br> Attendance
            </div>

            <div style="float: right;" class="mb-8" (click)="refresh($event)">
                <i class="sync alternate icon mr-2" style="font-size: 18px;color: #5e95bfeb;"></i>
            </div>

        </div>


        <div class="text-center">
            <img src="../../../../../assets/images/logos/KMLOGO.png" alt="kinderm8_logo" style="max-width: 100px;">
        </div>

        <br>
        <div class="header p-8 mb-16 text-center">


            <!-- <img src="{{user.getImage()}}" alt="user_img"> -->

            <nz-avatar [nzSize]="100" nzIcon="user" nzSrc="{{user.getImage()}}"></nz-avatar>

            <h1> HELLO {{user?.getFullName() | uppercase}}</h1>

            <nz-page-header icontemp [nzGhost]="false">
                <nz-page-header-title style="display: flex;">
                    <spa style="padding-top: 20px; font-size: 24px">
                        {{date}}
                    </spa>

                    <div
                        style="display: block!important; font-size: 14px; margin-left: 8px; margin-right: 8px; line-height: 0.4; padding-top: 20px;">
                        <p>
                            {{day}}
                        </p>
                        <p>
                            {{month}}
                        </p>
                    </div>
                    <span style="padding-top: 20px;font-size: 24px">
                        {{year}}
                    </span>

                </nz-page-header-title>
                <nz-page-header-extra style="padding-top: 20px">



                </nz-page-header-extra>
            </nz-page-header>

            <ng-template #icontemp>
                <i nz-icon nzType="calendar" nzTheme="outline"></i>
            </ng-template>

            <div class="text-center">

                <nz-list class="child-item-list" [nzNoResult]="emptyRoomBlock" [nzDataSource]="children"
                    [nzRenderItem]="item" [nzGrid]="{ gutter: 16, xs: 24, sm: 24, md: 24, lg: 24, xl: 24, xxl: 24 }">

                    <ng-template #item let-item>

                        <nz-list-item [nzContent]="item.isLoading ? '' : nzContent" class="{{getClass(item)}}">

                            <nz-skeleton [nzAvatar]="true" [nzActive]="true" [nzTitle]="false"
                                [nzParagraph]="{ rows: 3 }" [nzLoading]="item.isLoading">

                                <ng-template #nzContent>

                                    <nz-card (click)="showMessage($event, item)" (onLongPressing)="longPress()">

                                        <nz-list-item-meta [nzAvatar]="nzAvatar" [nzTitle]="nzTitle"
                                            [nzDescription]="nzDescription">

                                            <ng-template #nzAvatar>

                                                <nz-avatar [nzSize]="64" nzSrc="{{getProfile(item.index)}}"
                                                    class="item-img img-bg">
                                                </nz-avatar>

                                            </ng-template>

                                            <ng-template #nzTitle>

                                                <h3 class="text-truncate mb-4 text-left">{{ item.full_name}}</h3>
                                                <h5 class="text-truncate mb-4 text-left">{{ signinTime(item)}}</h5>
                                                <ng-container *ngIf="getDesc(item) === 'Absence'">
                                                    <h5 class="text-truncate mb-4 text-left" style="color: #e60505;">
                                                        Absence</h5>
                                                </ng-container>
                                                <ng-container *ngIf="getDesc(item) === 'Holiday'">
                                                    <h5 class="text-truncate mb-4 text-left">Holiday</h5>
                                                </ng-container>

                                                <h5 class="text-truncate mb-4 text-left">{{ getRoomTitle(item)}}</h5>

                                            </ng-template>

                                            <ng-template #nzDescription>

                                                <ng-container *ngIf="isShowAbsentButton(item)">

                                                    <p class="mb-2 text-right" *ngIf="item.bookings.length > 0">
                                                        <button nz-button nzType="danger" nzSize="small"
                                                            (click)="addDialog(item, $event, true)"
                                                            style="border-radius: 15px;">
                                                            Mark Absent
                                                        </button>
                                                    </p>


                                                </ng-container>


                                                <p class="m-0 text-right" *ngIf="isShowSignInButton(item)">
                                                    <button class="custom-btn" nz-button
                                                        nzType="{{getButtonText(item, true)}}" nzSize="small"
                                                        (click)="addDialog(item, $event, false)">
                                                        {{getButtonText(item, false)}}
                                                    </button>
                                                </p>

                                            </ng-template>

                                        </nz-list-item-meta>

                                    </nz-card>

                                </ng-template>

                            </nz-skeleton>

                        </nz-list-item>

                    </ng-template>

                </nz-list>

            </div>

        </div>

        <div fxLayout="column">

            <div nz-row nzJustify="center" nzAlign="top" [nzGutter]="24">

                <div class="text-center" nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="24" [nzXl]="12"
                    [nzXXl]="24">

                    <div mat-dialog-actions class="m-0 py-16 px-24 fm-border-top" fxLayout="row"
                        fxLayoutAlign="space-between center">

                        <button nzBlock nz-button nzType="danger" nzSize="large" [promiseBtn]="buttonLoader"
                            (click)="exit()">
                            Exit
                        </button>


                    </div>


                </div>
            </div>
        </div>
    </ng-container>

</div>