
<h3 class="my-16 mx-0"><i class="file alternate outline left icon mr-8"></i>Generate Report</h3>

<form name="branchForm" [nzLayout]="'vertical'" [formGroup]="filterForm" nz-form>

    <div class="px-4">

        <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32, xl: 32, xxl: 32 }">

            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12">

                <nz-form-item>

                    <nz-form-label nzRequired>Report Type</nz-form-label>

                    <nz-form-control nzHasFeedback [nzErrorTip]="typeErrorTpl">

                        <nz-select formControlName="type" nzShowSearch nzPlaceHolder="select a report type">

                            <nz-option 
                                *ngFor="let item of reportTypes; trackBy: trackByFn;"
                                nzValue="{{ item.value }}" 
                                nzLabel="{{ item.name }}">
                            </nz-option>

                        </nz-select>

                        <ng-template #typeErrorTpl let-control>
                            <ng-container *ngIf="control.hasError('required')">Please select a report type
                            </ng-container>
                        </ng-template>

                    </nz-form-control>

                </nz-form-item>

            </div>

            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12">

                <nz-form-item>

                    <div fxLayout="row" fxLayoutAlign="space-between center" class="h-24">
                        
                        <nz-form-label nzRequired>
                            Immunisation
                        </nz-form-label>

                        <div fxFlex="40" fxLayoutAlign="end center" class="select-actions">

                            <button 
                                nz-button nzType="link" 
                                class="p-0"
                                (click)="toggleSelectAllImmunisation(true)">Select All</button>

                            <span class="pl-4 pr-4">|</span>

                            <button nz-button nzType="link" class="p-0"
                                (click)="toggleSelectAllImmunisation(false)">Select None</button>

                        </div>
                    </div>

                    <nz-form-control nzHasFeedback [nzErrorTip]="parentErrorTpl">

                        <nz-select nzMode="multiple" formControlName="immunisation" nzShowSearch nzAllowClear
                            nzPlaceHolder="select a immunisation">

                            <nz-option *ngFor="let item of immunisation; trackBy: trackByFn;" nzValue="{{ item.id }}"
                                nzLabel="{{item.name}}">
                            </nz-option>

                        </nz-select>

                        <ng-template #parentErrorTpl let-control>
                            <ng-container *ngIf="control.hasError('required')">Please selecte a immunisation type
                            </ng-container>
                        </ng-template>

                    </nz-form-control>

                </nz-form-item>

            </div>
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12">

                <nz-form-item>

                    <div fxLayout="row" fxLayoutAlign="space-between center" class="h-24">
                        
                        <nz-form-label nzRequired>
                            Room
                        </nz-form-label>

                        <div fxFlex="40" fxLayoutAlign="end center" class="select-actions">

                            <button 
                                nz-button nzType="link" 
                                class="p-0"
                                (click)="toggleSelectAllRoom(true)">Select All</button>

                            <span class="pl-4 pr-4">|</span>

                            <button nz-button nzType="link" class="p-0"
                                (click)="toggleSelectAllRoom(false)">Select None</button>

                        </div>
                    </div>

                    <nz-form-control nzHasFeedback [nzErrorTip]="parentErrorTpl">

                        <nz-select nzMode="multiple" formControlName="room" nzShowSearch nzAllowClear
                            nzPlaceHolder="select a room">
                            <nz-option *ngFor="let item of room; trackBy: trackByFn;" nzValue="{{ item.id }}"
                                nzLabel="{{item.title}}">
                            </nz-option>

                        </nz-select>

                        <ng-template #parentErrorTpl let-control>
                            <ng-container *ngIf="control.hasError('required')">Please selecte a room
                            </ng-container>
                        </ng-template>

                    </nz-form-control>

                </nz-form-item>

            </div>

            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12">

                <nz-form-item>

                    <div fxLayout="row" fxLayoutAlign="space-between center" class="h-24">
                        
                        <nz-form-label nzRequired>
                            child
                        </nz-form-label>

                        <div fxFlex="40" fxLayoutAlign="end center" class="select-actions">

                            <button 
                                nz-button nzType="link" 
                                class="p-0"
                                (click)="toggleSelectAllChild(true)">Select All</button>

                            <span class="pl-4 pr-4">|</span>

                            <button nz-button nzType="link" class="p-0"
                                (click)="toggleSelectAllChild(false)">Select None</button>

                        </div>
                    </div>

                    <nz-form-control nzHasFeedback [nzErrorTip]="parentErrorTpl">

                        <nz-select nzMode="multiple" formControlName="child" nzShowSearch nzAllowClear
                            nzPlaceHolder="select a child"
                            [nzDisabled]="children.length === 0">

                            <nz-option *ngFor="let item of children; trackBy: trackByFn;" nzValue="{{ item.id }}"
                                nzLabel="{{item.getFullName()}}">
                            </nz-option>

                        </nz-select>

                        <ng-template #parentErrorTpl let-control>
                            <ng-container *ngIf="control.hasError('required')">Please selecte a child
                            </ng-container>
                        </ng-template>

                    </nz-form-control>

                </nz-form-item>

            </div>

            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12" *ngIf="filterForm.get('type').value === 'MEDI_CIMR'">

                <nz-form-item>

                    <nz-form-label nzRequired>Schedule</nz-form-label>

                    <nz-form-control nzHasFeedback [nzErrorTip]="typeErrorTpl">

                        <nz-select formControlName="schedule" nzShowSearch nzPlaceHolder="select a  schedule">

                            <nz-option 
                                *ngFor="let item of schedule; trackBy: trackByFn;"
                                nzValue="{{ item.id}}" 
                                nzLabel="{{ item.number }} {{ item.getScheduleTitle()}}">
                            </nz-option>

                        </nz-select>

                        <ng-template #typeErrorTpl let-control>
                            <ng-container *ngIf="control.hasError('required')">Please select a schedule
                            </ng-container>
                        </ng-template>

                    </nz-form-control>

                </nz-form-item>

            </div>

            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12" [nzLg]="12" [nzXl]="12" [nzXXl]="12">
                    
                <nz-form-item>
                
                    <nz-form-label>Show Inactive</nz-form-label>
                
                    <nz-form-control>
                
                        <nz-switch formControlName="inactive_children" nzCheckedChildren="Yes" nzUnCheckedChildren="No"></nz-switch>
                
                    </nz-form-control>
                
                </nz-form-item>

            </div>

        </div>

    </div>

    <div class="text-right px-4 mt-8" fxLayout="row" fxLayoutAlign="space-between center">

        <span></span>

        <span class="text-right">

            <ng-container *ngIf="filterForm.get('type').value === 'MEDI_CIMR'">
                <button class="text-uppercase mr-8" *hasPermission="['AC1']; belongsTo 'N60'" nz-button nzType="primary"
                    [disabled]="!filterForm.valid" [promiseBtn]="buttonLoader" (click)="submitReport($event, false)">
                    <i nz-icon nzType="file-pdf" nzTheme="outline"></i>view
                </button>
            </ng-container>
            

            <button class="text-uppercase mr-8"
                    *hasPermission="['AC1']; belongsTo 'N60'"
                    nz-button 
                    nzType="primary" 
                    [disabled]="!filterForm.valid"
                    [promiseBtn]="buttonLoader"
                    (click)="submitReport($event, true)">
                    <i nz-icon nzType="file-pdf" nzTheme="outline"></i>Download
            </button>
            <!-- <nz-dropdown-menu #menu="nzDropdownMenu">
                <ul nz-menu>
                    <li nz-menu-item (click)="submitReport($event, false, true)">
                        <i nz-icon nzType="file-pdf" nzTheme="outline"></i>PDF
                    </li>
                    <li nz-menu-item (click)="submitReport($event, false, false)">
                        <i nz-icon nzType="file-excel" nzTheme="outline"></i>CSV
                    </li>
                </ul>
            </nz-dropdown-menu> -->
        </span>

    </div>

</form>